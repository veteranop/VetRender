<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?define ProductVersion="3.0.1" ?>
  <?define ProductName="VetRender" ?>
  <?define Manufacturer="VetRender Team" ?>
  
  <Product 
    Id="*" 
    Name="$(var.ProductName)" 
    Language="1033" 
    Version="$(var.ProductVersion)" 
    Manufacturer="$(var.Manufacturer)" 
    UpgradeCode="12345678-1234-1234-1234-123456789012">
    
    <Package 
      InstallerVersion="200" 
      Compressed="yes" 
      InstallScope="perMachine" 
      Description="RF Propagation Analysis Tool"
      Comments="Professional RF propagation modeling with terrain analysis" />

    <MajorUpgrade 
      DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    
    <MediaTemplate EmbedCab="yes" />

    <Feature Id="ProductFeature" Title="VetRender" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentGroupRef Id="HarvestedFiles" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="ApplicationShortcutDesktop" />
    </Feature>

    <!-- Directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="VetRender" />
      </Directory>
      
      <!-- Start Menu -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="VetRender"/>
      </Directory>
      
      <!-- Desktop -->
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <!-- Start Menu Shortcut -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="A1B2C3D4-E5F6-7890-ABCD-EF1234567890">
        <Shortcut 
          Id="ApplicationStartMenuShortcut"
          Name="VetRender"
          Description="RF Propagation Analysis Tool"
          Target="[INSTALLFOLDER]VetRender.exe"
          WorkingDirectory="INSTALLFOLDER"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\VetRender" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- Desktop Shortcut -->
    <DirectoryRef Id="DesktopFolder">
      <Component Id="ApplicationShortcutDesktop" Guid="B2C3D4E5-F6A7-8901-BCDE-F12345678901">
        <Shortcut 
          Id="ApplicationDesktopShortcut"
          Name="VetRender"
          Description="RF Propagation Analysis Tool"
          Target="[INSTALLFOLDER]VetRender.exe"
          WorkingDirectory="INSTALLFOLDER"/>
        <RegistryValue Root="HKCU" Key="Software\VetRender" Name="desktopShortcut" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- UI -->
    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    
    <!-- License (optional - will use default if not present) -->
    <!-- Uncomment these if you create the files:
    <WixVariable Id="WixUILicenseRtf" Value="license.rtf" />
    <WixVariable Id="WixUIDialogBmp" Value="dialog.bmp" />
    <WixVariable Id="WixUIBannerBmp" Value="banner.bmp" />
    -->
  </Product>

  <!-- Main executable component -->
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="MainExecutable" Guid="C3D4E5F6-A7B8-9012-CDEF-123456789012">
        <File 
          Id="VetRenderEXE" 
          Source="dist\VetRender\VetRender.exe" 
          KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
  
  <!-- 
    NOTE: The HarvestedFiles ComponentGroup is generated by heat.exe
    Run build_installer.bat which executes:
    heat.exe dir "dist\VetRender" -cg HarvestedFiles -gg -sfrag -srd -dr INSTALLFOLDER -out harvested_files.wxs
  -->
</Wix>
